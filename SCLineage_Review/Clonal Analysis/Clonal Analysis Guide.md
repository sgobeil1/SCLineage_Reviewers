# SCLineage_Review Clonal Analysis

This file contains information about the clonal analysis pipeline used in **Gobeil et al. (2026)** and how to run the demo.

## Overview
This folder (`Clonal Analysis`) contains scripts for parsing MADM cells into clones. Wholemount microscopy images are opened in Imaris and the Spots function is usedto obtain coordinates of green, red, and yellow cells.  G, R, and Y cells. The 3D cell coordintes are exported and manual annotations of cell qualitative information are made (`RGY Spots` csv files). Each animal also gets a reference file (`Ref` csv file) with central canal and rotation information that is used to normalize the cell coordinates. Briefly, the `ClonalAnalysis` script normalizes cell coordinates to the central canal, rotates them so the DV axis is oriented vertically, and normalizes Z positions to a spinal cord of standard length. It then parses red/green cell clones based on inter-cell and inter-clone thresholds, excludes clones based on proximity to other clones, proximity to the end of a segment (each SC is cut into 6 segments for clearing and imaging), proximity to damage, and single-cell clones. The output is used for clone quantifications using `ClonalAnalysisSimplePlotting` and spatial analysis (see `Spatial Analysis` folder).

---

## 1. System requirements

### Operating system
Tested on Windows 10.

### Software
Python **3.10+** (written on 3.12.8)

### Python dependencies
- `numpy`
- `pandas`
- `scipy`
- `matplotlib`
- `seaborn` (used by plotting utilities / SimplePlotting)
- `pypalettes`
- `xlsxwriter` (used to write Excel summaries in SimplePlotting)

---

## 2. Installation guide
From a terminal:

```bash
pip install numpy pandas scipy matplotlib seaborn pypalettes xlsxwriter
```

**Typical install time:** ~5–10 minutes on a normal desktop (depends on internet speed).

---

## 3. Demo

The demo inputs live in:

- `Clonal Analysis/Demo/ClonalAnalysis_Input_File.csv`
- `Clonal Analysis/Demo/Clone_Ref.csv`
- plus the demo Imaris CSV exports referenced by `ClonalAnalysis_Input_File.csv` (in the same `Demo/` folder)

### 3.1 Download the code + demo files
- GitHub UI: **Code → Download ZIP**, then unzip

### 3.2 Run clone parsing (ClonalAnalysis)

1) Open `Clonal Analysis/ClonalAnalysis.py` and edit the **User input** paths at the top so they are **relative**:

```python
input_file_path = r"Demo/ClonalAnalysis_Input_File.csv"
additional_refs_path = r"Demo/Clone_Ref.csv"
overall_output_file_path = r"../Output/"
```

2) IMPORTANT: check the demo manifest paths  
Open `Clonal Analysis/Demo/ClonalAnalysis_Input_File.csv`. The `s1–s6` and `ref` columns must point to files on your computer.
- If the demo CSV currently contains absolute paths (e.g., `Z:/...`), replace them with paths to the demo files inside this repo (recommended: relative paths like `Demo/<filename>.csv`).

3) Run

### Expected output (ClonalAnalysis)
A timestamped output folder is created under `Output/`. The key file for the next step is:

- `*_rg_clones_*.csv`  (clone-level summary table)

**Expected runtime (demo):** typically a few minutes on a normal desktop (depends on dataset size).

---

### 3.3 Run quantification/plots (SimplePlotting)

1) Open `Clonal Analysis/ClonalAnalysisSimplePlotting.py` and update:
- the `sys.path.append(...)` line so it points to the local script folder (portable option):

```python
import os, sys
sys.path.append(os.path.dirname(__file__))
```

- the imports so they match the module names in this repo:

```python
import ClonalAnalysisFunctions as caf
import ClonalAnalysisPlots as cap
import ColPals as ColPals
```

2) Set `input_file_path` to the `_rg_clones_*.csv` generated by ClonalAnalysis (inside `../Output/<your_timestamped_folder>/`).

3) Run:

```bash
cd "Clonal Analysis"
python ClonalAnalysisSimplePlotting_20260126.py
```

### Expected output (SimplePlotting)
A timestamped plotting folder is created (as defined in the script), containing:
- figure files (e.g., `.svg`, `.png` depending on settings)
- summary tables (including `.xlsx` files)

**Expected runtime (demo):** typically a few minutes on a normal desktop.

---

## 4. Instructions for use (your own data)

### 4.1 Prepare inputs

To run `ClonalAnalysis.py` on your own dataset you need:

1) **Imaris “RGY Spots” CSV exports** (one per segment)  
   For each animal, export the Spots table for each cleared/imaged segment (`s1 … s6`) as a CSV (as in the demo).  
   These CSVs should include 3D coordinates (`Position X`, `Position Y`, `Position Z`) and your manual annotations (e.g., cell type flags).

2) **Per-animal “Ref” CSV exports** (one per animal)  
   A reference file containing central canal coordinates and rotation information per segment, used to normalize and rotate cell coordinates.

3) **`Clone_Ref.csv` (additional reference points)**  
   A table of reference points used by the pipeline for special cases (format matches the demo).  
   Required columns include:
   `Animal, Clone, Ref, Segment, Location, Position X, Position Y, Position Z, Rotation`

4) **`ClonalAnalysis_Input_File.csv` (manifest)**  
   A manifest with one row per animal and columns like the demo:
   `Litter, TM, TM Amount, Animal, s1, s2, s3, s4, s5, s6, ref, output folder name`  
   The `s1–s6` and `ref` entries are file paths to the CSVs above (absolute paths are fine; relative paths should be relative to the manifest location).

### 4.2 Run clone parsing + summary tables

1) In `Clonal Analysis/ClonalAnalysis.py`, update the **User input** variables:
- `input_file_path` → your manifest CSV  
- `additional_refs_path` → your `Clone_Ref.csv`  
- `overall_output_file_path` → output directory

2) Run from the `Clonal Analysis/` folder:

```bash
python ClonalAnalysis.py
```

**Key outputs**
- `Overall_rg_cells_*.csv` (cell-level table with clone assignments)  
- `*_rg_clones_*.csv` (clone-level summary used for quantification)

### 4.3 Quantify / plot clone-level outputs

Point `ClonalAnalysisSimplePlotting.py` (or `ClonalAnalysisSimplePlotting_20260126.py`) to the `*_rg_clones_*.csv` output and run:

```bash
python ClonalAnalysisSimplePlotting.py
```

---

## Code availability
Code repository: `https://github.com/sgobeil1/SCLineage_Review`

---

## Author
Sophie A. Gobeil

Institute of Science and Technology Austria
